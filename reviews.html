<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <title>Reviews - Pieter Paul Tybbe</title> 
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
  
<header id="main-header">
  <nav id="main-nav"></nav>
</header>

<header class="sesjat-header">
  <p class="glyph">ìÇÄ</p>
  <h1>Pieter Paul Tybbe</h1>
  <p class="subtitle">Reviews: Scherp, aandachtig en slechts licht bevooroordeeld</p>
</header>

<div class="filter-buttons">
    <button class="filter-btn active" data-filter="all">ALLES</button>
    <button class="filter-btn" data-filter="storygraph">BOEKEN</button>
    <button class="filter-btn" data-filter="letterboxd">FILMS</button>
</div>

<div class="filter-section">
  <div class="search-wrapper">
    <span class="search-icon">üîç</span>
    <input type="text" id="searchInput" class="search-bar" placeholder="reviews filteren...">
  </div>
</div>

<main class="grid" id="main-container"></main>

<script src="data/stories.js"></script>

<script>
window.addEventListener('DOMContentLoaded', () => {
    const container = document.getElementById("main-container");
    const searchInput = document.getElementById("searchInput");
    const filterButtons = document.querySelectorAll('.filter-btn');

    let currentList = [];
    const pageTitle = document.title;
    
    if (typeof stories !== 'undefined') {
        currentList = stories; 
    }
    
    if (pageTitle.includes("Archief") && typeof archiveStories !== 'undefined') {
        currentList = archiveStories;
    } else if (pageTitle.includes("Reviews") && typeof reviewStories !== 'undefined') {
        currentList = reviewStories;
    }

    let selectedPlatform = "all";

    // Functie voor sterren met strenge afronding (0.50 pas halve ster, 0.95 pas volle ster)
    function getStarsHtml(rating) {
        if (!rating) return "";
        let stars = '<div class="rating">';
        
        for (let i = 1; i <= 5; i++) {
            let diff = rating - (i - 1);

            if (diff >= 0.95) { 
                // Volle ster (bijv. 3.0, 4.0 of 3.95)
                stars += '<i class="fas fa-star"></i>';
            } else if (diff >= 0.50) { 
                // Halve ster pas vanaf 0.50 (dus 2.50 en 2.75 tonen een halve ster)
                stars += '<i class="fas fa-star-half-alt"></i>';
            } else {
                // 0.25 en lager blijft een lege ster
                stars += '<i class="far fa-star"></i>';
            }
        }
        
        stars += `<span class="rating-number">${rating}</span></div>`;
        return stars;
    }

    function render() {
        if (!container) return;
        container.innerHTML = "";
        
        const searchTerm = searchInput ? searchInput.value.toLowerCase() : "";

        const filtered = currentList.filter(item => {
            const matchesSearch = item.title.toLowerCase().includes(searchTerm) || 
                                 (item.year && item.year.toString().includes(searchTerm)) ||
                                 (item.director && item.director.toLowerCase().includes(searchTerm));
            
            const matchesPlatform = (selectedPlatform === "all" || item.platform === selectedPlatform);

            return matchesSearch && matchesPlatform;
        });

        [...filtered].reverse().forEach(item => {
            const card = document.createElement("article");
            card.className = "card";
            
            let iconHtml = "";
            if (item.platform === "letterboxd") {
                iconHtml = '<i class="fab fa-letterboxd"></i> ';
            } else if (item.platform === "storygraph") {
                iconHtml = '<i class="fas fa-book-open"></i> ';
            }
            
            const isExternal = !!item.link;
            const link = isExternal ? item.link : `story.html?id=${item.id}`;
            const target = isExternal ? 'target="_blank" rel="noopener noreferrer"' : '';
            const buttonText = isExternal ? `${iconHtml}LEES` : 'LEES';

            card.innerHTML = `
                <div class="card-content">
                    <img src="${item.image}" alt="${item.title}" class="card-image">
                    <div class="card-text">
                        <h2>${item.title}</h2>
                        ${getStarsHtml(item.rating)}
                        <p class="meta">${item.year || item.date || ""}</p>
                        ${item.director ? `<p class="meta-info"><em>${item.director}</em></p>` : ""}
                        <a href="${link}" ${target} class="read-link">${buttonText}</a>
                    </div>
                </div>
            `;
            container.appendChild(card);
        });

        if (filtered.length === 0) {
            container.innerHTML = "<p class='no-results'>Niets gevonden...</p>";
        }
    }

    filterButtons.forEach(btn => {
        btn.addEventListener('click', (e) => {
            filterButtons.forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            selectedPlatform = btn.getAttribute('data-filter');
            render();
        });
    });

    if (searchInput) {
        searchInput.addEventListener('input', render);
    }

    render();
});
</script>

<script>
  fetch('nav.html').then(res => res.text()).then(data => {
    const nav = document.getElementById('main-nav');
    if(nav) nav.innerHTML = data;
  });
</script>

</body>
</html>

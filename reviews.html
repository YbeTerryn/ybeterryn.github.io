<!DOCTYPE html>
<html lang="nl">
<head>
  <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-MJ1V2PREL6"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-MJ1V2PREL6');
</script>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <title>Reviews - Pieter Paul Tybbe</title> 
  <link rel="stylesheet" href="css/style.css">
</head>
<body>
  
<header id="main-header">
  <nav id="main-nav"></nav>
</header>

<header class="sesjat-header">
  <p class="glyph">ìÇÄ</p>
  <h1>Pieter Paul Tybbe</h1>
  <p class="subtitle">Reviews: Scherp, aandachtig en slechts licht bevooroordeeld</p>
</header>
<div class="filter-buttons">
    <button class="filter-btn active" data-filter="all">ALLES</button>
    <button class="filter-btn" data-filter="storygraph">BOEKEN</button>
    <button class="filter-btn" data-filter="letterboxd">FILMS</button>
</div>
<div class="filter-section">
  <div class="search-wrapper">
    <span class="search-icon">üîç</span>
    <input type="text" id="searchInput" class="search-bar" placeholder="reviews filteren...">
  </div>
</div>

<main class="grid" id="main-container"></main>

<script src="data/stories.js"></script>

<script>
window.addEventListener('DOMContentLoaded', () => {
    const container = document.getElementById("main-container");
    const searchInput = document.getElementById("searchInput");
    const filterButtons = document.querySelectorAll('.filter-btn');

    let currentList = [];
    const pageTitle = document.title;
    
    // 1. Verzamel de juiste data op basis van de pagina
    if (pageTitle.includes("Offers")) {
        currentList = typeof stories !== 'undefined' ? stories : [];
    } else if (pageTitle.includes("Archief")) {
        currentList = typeof archiveStories !== 'undefined' ? archiveStories : [];
    } else if (pageTitle.includes("Reviews")) {
        // Zorg dat reviewStories gedefinieerd is in je data-bestanden
        currentList = typeof reviewStories !== 'undefined' ? reviewStories : [];
    }

    // 2. Filterstatus bijhouden (standaard alles tonen)
    let selectedPlatform = "all";

    function render() {
        if (!container) return;
        container.innerHTML = "";
        
        const searchTerm = searchInput ? searchInput.value.toLowerCase() : "";

        // 3. Filteren op platform EN op zoekterm
        const filtered = currentList.filter(item => {
            const matchesSearch = item.title.toLowerCase().includes(searchTerm) || 
                                 (item.year && item.year.toString().includes(searchTerm)) ||
                                 (item.director && item.director.toLowerCase().includes(searchTerm));
            
            const matchesPlatform = (selectedPlatform === "all" || item.platform === selectedPlatform);

            return matchesSearch && matchesPlatform;
        });

        // 4. De kaartjes tekenen (in omgekeerde volgorde voor nieuwste bovenaan)
        filtered.slice().reverse().forEach(item => {
            const card = document.createElement("article");
            card.className = "card";
            
            let iconHtml = "";
            if (item.platform === "letterboxd") {
                iconHtml = '<i class="fab fa-letterboxd"></i> ';
            } else if (item.platform === "storygraph") {
                iconHtml = '<i class="fas fa-book-open"></i> ';
            }
            
            const isExternal = !!item.link;
            const link = isExternal ? item.link : `story.html?id=${item.id}`;
            const target = isExternal ? 'target="_blank" rel="noopener noreferrer"' : '';
            const buttonText = isExternal ? `${iconHtml}LEES` : 'LEES';

            card.innerHTML = `
                <div class="card-content">
                    <img src="${item.image}" alt="${item.title}" class="card-image">
                    <div class="card-text">
                        <h2>${item.title}</h2>
                        <p class="meta">${item.year || item.date || ""}</p>
                        ${item.director ? `<p class="meta-info"><em>${item.director}</em></p>` : ""}
                        <a href="${link}" ${target} class="read-link">${buttonText}</a>
                    </div>
                </div>
            `;
            container.appendChild(card);
        });

        if (filtered.length === 0) {
            container.innerHTML = "<p class='no-results'>Niets gevonden...</p>";
        }
    }

    // 5. Event listeners voor de filterknoppen
    filterButtons.forEach(btn => {
        btn.addEventListener('click', (e) => {
            filterButtons.forEach(b => b.classList.remove('active'));
            e.target.classList.add('active');
            selectedPlatform = e.target.getAttribute('data-filter');
            render();
        });
    });

    // 6. Event listener voor de zoekbalk
    if (searchInput) {
        searchInput.addEventListener('input', render);
    }

    // 7. Eerste keer laden
    render();
});

</body>
</html>
